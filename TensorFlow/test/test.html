<html>
  <head>
    <!-- Load TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <!-- Load MobileNet -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>
    <!-- Load KNN Classifier -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/knn-classifier"></script>
 </head>

  <body>
    <img id='class0' src='0.jpg' width="300" height="300">
    <img id='class1' src='1.jpg' width="300" height="300">
    <img id='class2' src='2.jpg' width="300" height="300">
    <img id='class0-1' src='0-1.jpg' width="300" height="300">
    <img id='class1-1' src='1-1.jpg' width="300" height="300">
    <img id='class2-1' src='2-1.jpg' width="300" height="300">
    <img id='class0-2' src='0-2.jpg' width="300" height="300">
    <img id='class1-2' src='1-2.jpg' width="300" height="300">
    <img id='class2-2' src='2-2.jpg' width="300" height="300">    
    <br>
    <img id='test' src='test.jpg' width="300" height="300">
    <div id="result"></div>
  </body>
  <!-- Place your code in the script tag below. You can also use an external .js file -->
  <script>

    var classifier;
    var mobilenetModule;
    
    // Create the classifier.
    classifier = knnClassifier.create();

    // Load mobilenet.
    mobilenet.load().then(Module => {
      mobilenetModule = Module;

      addExampleImage(document.getElementById("class0"),0);
      addExampleImage(document.getElementById("class0-1"),0);
      addExampleImage(document.getElementById("class0-2"),0);
      addExampleImage(document.getElementById("class1"),1);
      addExampleImage(document.getElementById("class1-1"),1);
      addExampleImage(document.getElementById("class1-2"),1);
      addExampleImage(document.getElementById("class2"),2);
      addExampleImage(document.getElementById("class2-1"),2);
      addExampleImage(document.getElementById("class2-2"),2);

      predictClass(document.getElementById("test"));
    }); 

    function addExampleImage(img,index) {
      // Add MobileNet activations to the model repeatedly for all classes.
      var Image = tf.browser.fromPixels(img);
      var logits = mobilenetModule.infer(Image, 'conv_preds');
      classifier.addExample(logits, index);
    }
    
    async function predictClass(img) {
      // Make a prediction.
      const Image = tf.browser.fromPixels(img);
      const xlogits = mobilenetModule.infer(Image, 'conv_preds');
      const result = await classifier.predictClass(xlogits);
      console.log(result);
      document.getElementById("result").innerHTML = result.label;    
    }
  </script>
</html>
