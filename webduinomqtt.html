<!doctype html>
<html>
  <head>
  <meta charset="UTF-8">
  <title>Webduino mqtt</title>
  <script src="https://blocklypro.webduino.io/components/jquery/dist/jquery.min.js"></script>
  <script src="https://blocklypro.webduino.io/dist/lib/webduino-all-0.4.20.min.js"></script>
  <script src="https://blocklypro.webduino.io/dist/webduino-blockly.min.js"></script>
  <script src="https://blocklypro.webduino.io/dist/lib/firebase.min.js"></script>
  <script src="https://blocklypro.webduino.io/dist/lib/runtime.min.js"></script>
  <script src="https://blocklypro.webduino.io/node_modules/webduino-module-mqtt/mqttClient.min.js"></script>
 </head>
 <body>
    <span id="message"></span>
 </body>
</html>
<script>
  var strUrl=location.search;
  if (strUrl.indexOf("?")!=-1) {
    document.getElementById('message').innerHTML = strUrl.split("?")[1];
  }  
</script>
<script id="jsbin-javascript">
  (async function () {
	var topic = "my/helloworld";
	var webduinoMQTTClient = new webduino.module.mqttClient();
	await webduinoMQTTClient.connect({ server: 'wss://mqtt1.webduino.io/mqtt' });
	await webduinoMQTTClient.subscribe(topic);
	var message = document.getElementById('message').innerHTML;
	if (message!="") {
	  webduinoMQTTClient.send({topic: topic,message: message});
	}
  }());
</script> 
