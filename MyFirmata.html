<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta name="robots" content="noindex">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>MyFirmata</title>
  <script src="https://bit.webduino.io/blockly/components/jquery/dist/jquery.min.js"></script>
  <script src="https://bit.webduino.io/blockly/dist/lib/webduino-all.min.js"></script>
  <script src="https://bit.webduino.io/blockly/dist/MessageTransport.min.js"></script>
  <script src="https://bit.webduino.io/blockly/dist/MessageTransport.min.js"></script>
  <script src="https://bit.webduino.io/blockly/dist/webduino-blockly.min.js"></script>
  <script src="https://bit.webduino.io/blockly/dist/lib/firebase.min.js"></script>
  <script src="https://bit.webduino.io/blockly/dist/lib/runtime.min.js"></script>
  <script src="https://bit.webduino.io/blockly/components/webduino-bit-module-led-matrix/BitLedMatrix-blockly.js"></script>
  <script src="https://bit.webduino.io/blockly/components/webduino-bit-module-led-matrix/BitLedMatrix.js"></script>
  <script src="https://bit.webduino.io/blockly/components/webduino-bit-module-photocell/BitPhotocell-blockly.js"></script>
<style id="jsbin-css">
#demo-area-01-show { font-size: 36px; pointer-events: auto!important; }
</style>
</head>
<body>

<div><span id="demo-area-01-show">MyFirmata</span></div>
<input type="text" name="cmd" id="cmd">
<select name="led" id="led">
<option value="1">1</option>
<option value="2">2</option>
<option value="3">3</option>
<option value="4">4</option>
<option value="5">5</option>
<option value="6">6</option>
<option value="7">7</option>
<option value="8">8</option>
<option value="9">9</option>
<option value="10">10</option>
<option value="11">11</option>
<option value="12">12</option>
<option value="13">13</option>
<option value="14">14</option>
<option value="15">15</option>
<option value="16">16</option>
<option value="17">17</option>
<option value="18">18</option>
<option value="19">19</option>
<option value="20">20</option>
<option value="21">21</option>
<option value="22">22</option>
<option value="23">23</option>
<option value="24">24</option>
<option value="25">25</option>
</select>
<select name="state" id="state">  
<option value="on">on</option>
<option value="off">off</option>
</select>
  
<script id="jsbin-javascript">
(async function () {
  
  let button = document.createElement('button');
  button.textContent = "執行";
  button.onclick = function() {
      document.getElementById("cmd").value="?metrixled="+document.getElementById("led").value+";on";
  };
  document.body.appendChild(button).setAttribute('id','button');
  
  var strUrl=location.search;
  if (strUrl.indexOf("?")!=-1) {
    var getCmd = strUrl.split("?");
    var getPara = getCmd[1].split("&");
    
    boardReady({board: 'Bit', device: getPara[0], transport: 'mqtt'}, function (board) {
      document.getElementById("demo-area-01-show").innerHTML = "Bit is connected.";
      
      board.samplingInterval = 250;
      var matrix = getMatrix(board, 4, 25);
      
      var fuTimer = setInterval(function(){
        var cmd = document.getElementById("cmd");
        if (cmd.value == '?metrixled=1;on') {
          matrix.setColor((1 - 1), '#ff0000');
          cmd.value ="";
        } else if (cmd.value == '?metrixled=2;on') {
          matrix.setColor((2 - 1), '#ff0000');
          cmd.value ="";
        } else if (cmd.value == '?metrixled=1;off') {
          matrix.setColor((1 - 1), '#000000');
          cmd.value ="";
        } else if (cmd.value == '?photocell_l') {
          var photocell_l = getPhotocell(board, 0);
          photocell_l.measure(async function (val){
            photocell_l.detectedVal = val;
          });
          document.getElementById("demo-area-01-show").innerHTML = photocell_l.detectedVal;
          cmd.value ="";
        } else if (cmd.value == '?photocell_r') {
          var photocell_r = getPhotocell(board, 3);
          photocell_r.measure(async function (val){
            photocell_r.detectedVal = val;
          });
          document.getElementById("demo-area-01-show").innerHTML = photocell_r.detectedVal;
          cmd.value ="";
        }
      },100);
    });
  }
}());
</script>
</body>
</html>
