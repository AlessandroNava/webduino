<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta name="robots" content="noindex">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>MyFirmata</title>
<script src="https://bit.webduino.io/blockly/components/jquery/dist/jquery.min.js"></script>
<script src="https://bit.webduino.io/blockly/dist/lib/webduino-all.min.js"></script>
<script src="https://bit.webduino.io/blockly/dist/MessageTransport.min.js"></script>
<script src="https://bit.webduino.io/blockly/dist/webduino-blockly.min.js"></script>
<script src="https://bit.webduino.io/blockly/dist/lib/firebase.min.js"></script>
<script src="https://bit.webduino.io/blockly/dist/lib/runtime.min.js"></script>
<script src="https://bit.webduino.io/blockly/components/webduino-bit-module-led-matrix/BitLedMatrix-blockly.js"></script>
<script src="https://bit.webduino.io/blockly/components/webduino-bit-module-led-matrix/BitLedMatrix.js"></script>
<script src="https://bit.webduino.io/blockly/components/webduino-bit-module-photocell/BitPhotocell-blockly.js"></script>
<style id="jsbin-css">
#demo-area-01-show { font-size: 60px; pointer-events: auto!important; }
</style>
</head>
<body>
  

<div><span id="demo-area-01-show">123</span></div>

<script id="jsbin-javascript">
(async function () {
  var strUrl=location.search;
  if (strUrl.indexOf("?")!=-1) {
    var getCmd = strUrl.split("?");
    var getPara = getCmd[1].split("&");
    
    var matrix;
    var photocell_l;
    var photocell_r;
    var cmd;
    
    boardReady({board: 'Bit', device: getPara[0], transport: 'message', window: window.top.frames[0]}, async function (board) {
      document.getElementById("demo-area-01-show").innerHTML = getPara[0];
      board.samplingInterval = 250;
      matrix = getMatrix(board, 4, 25);
      photocell_l = getPhotocell(board, 0);
      photocell_r = getPhotocell(board, 3);
      
      cmd = '?metrixled=1;on';
      
      photocell_l.measure(async function (val){
        photocell_l.detectedVal = val;
      });
      
      while (true) {
        if (cmd == '?metrixled=1;on') {
          matrix.setColor((1 - 1), '#ff0000');
        } else if (cmd == '?metrixled=1;off') {
          matrix.setColor((1 - 1), '#000000');
        } else if (cmd== '?photocell_l') {
          document.getElementById("demo-area-01-show").innerHTML = photocell_l.detectedVal;
        }
        await delay(0.1);
      }
    });
  }
}());
</script>
</body>
</html>
